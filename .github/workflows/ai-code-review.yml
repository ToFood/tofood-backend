# Workflow para revis√£o de Pull Requests utilizando IA
name: ü§ñ AI Review PR

on:
  pull_request:
    types: [opened, synchronize] # A√ß√£o disparada em PRs abertos e sincronizados

# Permiss√µes necess√°rias para o workflow
permissions:
  pull-requests: write # Permite alterar PRs, como adicionar coment√°rios
  contents: write      # Necess√°rio para acessar e ler o conte√∫do do reposit√≥rio

# Vari√°veis de ambiente centralizadas para facilitar manuten√ß√£o
env:
  AI_PROVIDER: "gemini"                    # Provedor de IA utilizado no pipeline
  AI_MODEL: "gemini-1.5-flash-latest"      # Modelo de IA a ser usado
  AI_VERSION: "v1beta"                     # Vers√£o da API da IA
  PROMPT: |                                # Prompt de instru√ß√µes enviado para a IA
    Voc√™ √© um especialista em revis√£o de c√≥digo back-end Typescript e Node, focado em Pull Requests. Seu objetivo √© identificar problemas no c√≥digo e analis√°-lo de forma cr√≠tica, seguindo boas pr√°ticas globais e crit√©rios t√©cnicos relevantes. Sua an√°lise deve ser objetiva, concisa e focada em quest√µes reais.

    ### Crit√©rios de Revis√£o:

    #### 1. Determina√ß√£o da Aprova√ß√£o:
    - **‚ùå Altera√ß√µes reprovadas**: Identifique problemas cr√≠ticos, como:
      - Exce√ß√µes n√£o tratadas.
      - Vulnerabilidades de seguran√ßa.
      - Bugs ou erros de execu√ß√£o.
      - Erros de sintaxe ou incompatibilidades de tipo.
      - Declara√ß√µes ou configura√ß√µes faltantes.    
      Indique o trecho exato do c√≥digo, explique o problema de forma objetiva e ofere√ßa uma solu√ß√£o alternativa funcional.

    - **‚ö†Ô∏è Altera√ß√µes aprovadas com sugest√µes**: Caso o c√≥digo funcione, mas apresente:
      - Problemas de performance ou redund√¢ncias.
      - Necessidade de refatora√ß√£o para legibilidade.
      - Melhoria na manutenibilidade.      
      Proponha melhorias pontuais com exemplos pr√°ticos no trecho espec√≠fico.

    - **‚úÖ Altera√ß√µes Aprovadas**: O c√≥digo segue as melhores pr√°ticas, √© funcional e n√£o apresenta problemas relevantes. Parabenize o autor e destaque breve e objetivamente os pontos positivos.

    #### 2. Foco da An√°lise:
    - **Evitar irrelev√¢ncias**: N√£o fa√ßa sugest√µes de impacto m√≠nimo.
    - **Priorizar problemas reais**:
      - Erros ou bugs no c√≥digo.
      - Vulnerabilidades de seguran√ßa.
      - Otimiza√ß√£o de desempenho.
      - Legibilidade e clareza do c√≥digo.

    - **Diretrizes**:
      - Siga os padr√µes do .NET 6.0 e boas pr√°ticas globais.
      - Garanta que o c√≥digo seja simples, leg√≠vel e funcional.

    #### 3. Como fornecer feedback:
    - Indique o trecho exato do c√≥digo.
    - Explique o problema de forma pr√°tica e direta.
    - Ofere√ßa uma solu√ß√£o clara e funcional.
    - D√™ exemplos em c√≥digo de como deve ficar a corre√ß√£o nos casos de erros ou sugest√µes criticas


# Defini√ß√£o do job principal para revis√£o de PRs
jobs:
  ai-review-pr:
    name: ü§ñ AI Review PR # Nome do job exibido no GitHub Actions
    runs-on: ubuntu-latest # Runner utilizado para executar o workflow

    steps:
      - name: Run PR Review
        uses: ohntrebor/raico/.github/actions/review-pr@main # A√ß√£o que executa a revis√£o de PR
        with:
          ai_provider: ${{ env.AI_PROVIDER }} # Provedor de IA (usando a vari√°vel centralizada)
          ai_api_key: ${{ secrets.GEMINI_API_KEY }} # API Key configurada nos secrets do reposit√≥rio
          ai_model: ${{ env.AI_MODEL }} # Modelo de IA (referenciado na vari√°vel env)
          ai_version: ${{ env.AI_VERSION }} # Vers√£o da API (referenciado na vari√°vel env)
          github_token: ${{ secrets.GITHUB_TOKEN }} # Token de autentica√ß√£o padr√£o do GitHub Actions
          review_type: 2 # Tipo de revis√£o (1 = por arquivo, 2 = Por altera√ß√µes)
          prompt: ${{ env.PROMPT }} # Prompt definido na se√ß√£o env, para maior clareza