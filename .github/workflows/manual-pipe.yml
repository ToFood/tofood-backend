name: Pipeline Test

on:
  push:
    branches:
      - "**" # Qualquer branch

jobs:
  build:
    name: ğŸ› ï¸ Build
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ¨ Checkout do repositÃ³rio
        uses: actions/checkout@v4

      - name: ğŸ“¦ Instalar dependÃªncias
        run: npm install

      - name: ğŸ› ï¸ Build do projeto
        run: npm run build

  approval:
    name: â¸ï¸ AprovaÃ§Ã£o Manual
    runs-on: ubuntu-latest
    needs: build
    environment: 
      name: approval-environment # Configurado no GitHub
    steps:
      - name: Aguardando AprovaÃ§Ã£o Manual
        run: echo "ğŸ”„ Aguardando aÃ§Ã£o manual para continuar o pipeline..."
      - name: Verificar AprovaÃ§Ã£o
        if: ${{ github.event.deployment_status.state == 'failure' }}
        run: echo "âš ï¸ AprovaÃ§Ã£o negada. Encerrando pipeline sem erro."

  test:
    name: ğŸ§ª Testes da AplicaÃ§Ã£o
    runs-on: ubuntu-latest
    needs: approval # Depende da aprovaÃ§Ã£o para continuar
    if: ${{ github.event.deployment_status.state == 'success' }} # Somente continua se aprovado
    steps:
      - name: ğŸ¨ Checkout do repositÃ³rio
        uses: actions/checkout@v4

      - name: ğŸ“¦ Instalar dependÃªncias
        run: npm install

      - name: ğŸ§ª Executar Testes
        run: npm test
